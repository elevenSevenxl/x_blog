---
title: 强制缓存和协商缓存
cover: /assets/images/cover11.jpg
isTimeLine: true
date: 2023-10-01
# order: 3
# sticky: true
# star: true
footer: <a href="https://icp.gov.moe/?keyword=20255521" target="_blank">萌 ICP 备 20255521 号</a>
copyright: Copyright © 2025 没有蜡笔的小新
category:
  - 前端
tag:
  - http
---

---

### 缓存

HTTP/1.1 支持缓存。缓存是一种在客户端和服务器之间存储和复用资源的机制，可以提高性能和减少网络流量。它允许客户端在后续请求中避免重新请求相同资源，而是直接从本地缓存中获取资源副本。HTTP/1.1 提供了两种缓存方式，强制缓存和协商缓存。

#### 强制缓存

强制缓存是通过设置响应首部字段的缓存控制字段，让客户端在一定时间内强制使用本地缓存机制。即使服务器已经有更新，客户端也不会发送请求到服务器进行验证，而是直接从本地缓存中获取资源。

强制缓存主要通过两类字段进行控制，分别是 **Cache-Control** 和 **Expires**。其中：

Cache-Control 字段不仅可以用来指定资源的有效期，还可以指定资源的缓存策略。常见指定包含：

- public：允许任何中间代理服务器和客户端缓存该资源；
- private：仅允许客户端缓存该资源，不允许中间代理服务器缓存；
- max-age：指定资源的有效期，如 Cache-Control:max-age=3600 指示资源在接下来的 3600 秒内都可以直接从缓存中获取。

Expires 字段用于指定资源的过期时间。如 Expires: Wed, 22 Sep 2023 12:00:00 GMT 表示资源在该时间点之后过期。

若服务器的响应首部同时返回 Cache-Control 和 Expires 字段的话，Cache-Control 的优先级比 Expires 高。

#### 协商缓存

协商缓存是一种在客户端和服务器之间进行资源验证的机制，用于确定客户端是否可以继续使用缓存的副本，而无需获取完整的资源内容。它通过比较资源的相关标识（如 Last-Modified 和 ETag）来确定资源是否已经发生了变化。如果资源未发生变化，服务器可以返回一个轻量级的响应，表示资源未修改，客户端可以继续使用缓存的副本。

协商缓存也是通过两类字段进行控制，分别是 Last-Modified 和 ETag。其中：

**Last-Modified** 字段用于指示请求资源最后的修改时间。当客户端发起请求时，会在 If-Modified-Since 中写入上次资源的 Last-Modified。服务器会比较两者的时间，如果资源最后修改的时间较早，则服务器返回 304 表示资源未发生变化，可以使用缓存副本。

**ETag** 字段用于指定资源的唯一性。当客户端发起请求时，它会在请求头中包含 If-None-Match 字段，该字段的值为先前获取资源时服务器返回的 ETag 值。服务器会将这两个值进行比较，如果资源的 ETag 值匹配，则服务器返回 304 Not Modified 响应，表示资源未发生变化，可以使用缓存副本。

ETag 的优先级比 Last-Modified 高。因为不修改文件时间也会改变，而且有些文件是在毫秒级别改变的，Last-Modified 只能精确秒。

---
